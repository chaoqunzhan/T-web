# mobx miniprogramÁöÑÂéüÁêÜ
`mobx-miniprogram` ÁöÑÊ†∏ÂøÉ‰ª∑ÂÄºÂú®‰∫éÂÆÉÂ∑ßÂ¶ôÂú∞ËøûÊé•‰∫Ü MobX Âº∫Â§ßÁöÑÂìçÂ∫îÂºèÁ≥ªÁªüÂíåÂ∞èÁ®ãÂ∫èÁã¨ÁâπÁöÑÂèåÁ∫øÁ®ãÊû∂ÊûÑÔºåËß£ÂÜ≥‰∫ÜÂéüÁîüÂºÄÂèë‰∏≠Áä∂ÊÄÅÁÆ°ÁêÜÊ∑∑‰π±Âíå `setData` ÊÄßËÉΩ‰Ωé‰∏ãÁöÑÁóõÁÇπ„ÄÇ

### Ê†∏ÂøÉÂéüÁêÜÂõæËß£

ËøôÂº†ÂõæÂ±ïÁ§∫‰∫ÜÊï∞ÊçÆÊòØÂ¶Ç‰Ωï‰ªé MobX Store ÊµÅÂêëÂ∞èÁ®ãÂ∫èËßÜÂõæÂ±ÇÔºå‰ª•Âèä `mobx-miniprogram` Âú®ÂÖ∂‰∏≠ÊâÆÊºîÁöÑ‚ÄúÊô∫ËÉΩÊ°•Ê¢Å‚ÄùËßíËâ≤„ÄÇ

![ÂõæÁâá1](./mobx.png "ÂõæÁâá1")

---

### ÂÖ∑‰ΩìÂÆûÁé∞ÈÄªËæëÊ∑±Â∫¶Ëß£Êûê

`mobx-miniprogram` ÁöÑÂ∑•‰ΩúÊµÅÁ®ãÂèØ‰ª•ÊãÜËß£‰∏∫Âõõ‰∏™ÂÖ≥ÈîÆÈò∂ÊÆµÔºö**ÂàùÂßãÂåñËøûÊé•„ÄÅ‰æùËµñÊî∂ÈõÜ„ÄÅÂìçÂ∫îÂºèËß¶Âèë„ÄÅÁ≤æÂáÜÊõ¥Êñ∞**„ÄÇ

#### 1. ÂàùÂßãÂåñËøûÊé• (Initialization & Connection)

ÂΩì‰Ω†‰ΩøÁî® `StoreBehavior` ÊàñËÄÖ `createStoreBindings` Â∞ÜÂ∞èÁ®ãÂ∫èÈ°µÈù¢/ÁªÑ‰ª∂‰∏é MobX store ËøûÊé•Êó∂ÔºåÂ∫ìÁöÑÂÜÖÈÉ®‰ª£Á†Å‰ºö‰ªãÂÖ•Â∞èÁ®ãÂ∫èÁöÑÁîüÂëΩÂë®ÊúüÔºàÂ¶Ç `onLoad`, `attached`Ôºâ„ÄÇ

**ÂÖ∑‰ΩìÈÄªËæëÔºö**

* **ËØªÂèñÈÖçÁΩÆ**ÔºöÂ∫ì‰ºöËØªÂèñ‰Ω†‰º†ÂÖ•ÁöÑÈÖçÁΩÆÂØπË±°ÔºåÈáçÁÇπÊòØ `fields`Ôºà‰Ω†ÈúÄË¶ÅÂì™‰∫õÊï∞ÊçÆÔºâÂíå `actions`Ôºà‰Ω†ÈúÄË¶ÅÂì™‰∫õÊìç‰ΩúÊñπÊ≥ïÔºâ„ÄÇ
* **Êò†Â∞Ñ Actions**ÔºöÂ∞Ü store ‰∏≠ÁöÑÊñπÊ≥ïÁõ¥Êé•ÊåÇËΩΩÂà∞ÂΩìÂâçÈ°µÈù¢/ÁªÑ‰ª∂ÂÆû‰æãÔºà`this`Ôºâ‰∏äÔºåÊñπ‰æøÁõ¥Êé•Ë∞ÉÁî®„ÄÇ
* **ÂàõÂª∫ ReactionÂÆø‰∏ª**ÔºöÂú®ÂΩìÂâçÁªÑ‰ª∂ÂÆû‰æã‰∏äÂàõÂª∫‰∏Ä‰∏™‰∏ìÈó®Áî®‰∫éÁÆ°ÁêÜ MobX ÁõëÂê¨Âô®ÁöÑÂÆπÂô®„ÄÇ

#### 2. ‰æùËµñÊî∂ÈõÜ (Dependency Collection) ‚Äî‚Äî Ê†∏ÂøÉÈ≠îÊ≥ï

ËøôÊòØ MobX ÊúÄÁ•ûÂ•áÁöÑÂú∞Êñπ„ÄÇÂÆÉ‰∏çÈúÄË¶Å‰Ω†ÊâãÂä®Â£∞Êòé‚ÄúÂΩì A ÂèòÂåñÊó∂Êõ¥Êñ∞ B‚ÄùÔºåËÄåÊòØËá™Âä®‰æ¶Êµã„ÄÇ

**ÂÖ∑‰ΩìÈÄªËæëÔºö**

* Âú®ÂàùÂßãÂåñÈò∂ÊÆµÔºå`mobx-miniprogram` ‰ºöÂàõÂª∫‰∏Ä‰∏™ **MobX ReactionÔºàÂìçÂ∫îÂô®Ôºâ**„ÄÇ
* Ëøô‰∏™ Reaction ‰ºöÁ´ãÂç≥ÊâßË°å‰∏ÄÊ¨°**È¢ÑËØªÈÄªËæë**„ÄÇÂÆÉ‰ºöÈÅçÂéÜ‰Ω†Âú® `fields` ‰∏≠Â£∞ÊòéÁöÑÊâÄÊúâÂ≠óÊÆµÔºåÂπ∂Â∞ùËØï‰ªé MobX Store ‰∏≠ËØªÂèñÂÆÉ‰ª¨ÁöÑÂÄº„ÄÇ
* **ÂÖ≥ÈîÆÁÇπ**ÔºöÁî±‰∫é MobX Store ÁöÑÊï∞ÊçÆÊòØË¢´ Proxy (Êàñ Object.defineProperty) ÂåÖË£πÁöÑ„ÄÇÂΩì‰Ω†‚ÄúËØªÂèñ‚ÄùÂ±ûÊÄßÊó∂ÔºåMobX ÂÜÖÈÉ®Êú∫Âà∂‰ºöÊçïËé∑Âà∞Ëøô‰∏™ËØªÂèñÊìç‰ΩúÔºåÂπ∂Â∞ÜÂΩìÂâçÁöÑ Reaction ËÆ∞ÂΩï‰∏∫ËØ•Â±ûÊÄßÁöÑ‚ÄúËßÇÂØüËÄÖÔºàObserverÔºâ‚Äù„ÄÇ
* **ÁªìÊûú**ÔºöÂª∫Á´ã‰∫Ü‰∏ÄÂº†ÈöêÂΩ¢ÁöÑ‰æùËµñÂõæ„ÄÇ‰æãÂ¶ÇÔºåÂ¶ÇÊûú‰Ω†ÁöÑÁªÑ‰ª∂Âè™ËØªÂèñ‰∫Ü `store.userInfo.name`ÔºåÈÇ£‰πàÂè™ÊúâÂΩì `name` ÂèëÁîüÂèòÂåñÊó∂ÔºåËøô‰∏™ÁªÑ‰ª∂Êâç‰ºöË¢´Ê†áËÆ∞‰∏∫ÈúÄË¶ÅÊõ¥Êñ∞„ÄÇÂ¶ÇÊûú `store.otherData` Âèò‰∫ÜÔºåËøô‰∏™ÁªÑ‰ª∂ÂÆåÂÖ®Êó†ÊÑü„ÄÇ

#### 3. ÂìçÂ∫îÂºèËß¶Âèë (Reactivity Trigger)

ÂΩìÂ∫îÁî®ËøêË°åËµ∑Êù•ÂêéÔºåÁî®Êà∑‰∫§‰∫íËß¶Âèë‰∫ÜÊüê‰∏™ `Action`„ÄÇ

**ÂÖ∑‰ΩìÈÄªËæëÔºö**

* **‰øÆÊîπÁä∂ÊÄÅ**ÔºöAction ÈáåÁöÑ‰ª£Á†Å‰øÆÊîπ‰∫Ü Store ‰∏≠ÁöÑ Observable Êï∞ÊçÆ„ÄÇ
* **ÈÄöÁü•ËßÇÂØüËÄÖ**ÔºöMobX ÁõëÊµãÂà∞Êï∞ÊçÆÂèòÂåñÔºåÂÆÉ‰ºöÊü•Êâæ‰æùËµñÂõæÔºåÊâæÂà∞ÊâÄÊúâ‚ÄúËßÇÂØü‚Äù‰∫ÜËøô‰∏™Êï∞ÊçÆÁöÑ Reaction„ÄÇ
* **Ëß¶ÂèëÊâßË°å**ÔºöMobX ÈÄöÁü•Ëøô‰∫õ Reaction ÈáçÊñ∞ËøêË°å„ÄÇ

#### 4. Á≤æÂáÜÊõ¥Êñ∞ (Optimized Update & setData) ‚Äî‚Äî ÊÄßËÉΩÂÖ≥ÈîÆ

ËøôÊòØ `mobx-miniprogram` Âå∫Âà´‰∫éÊôÆÈÄö MobX ‰ΩøÁî®Âú∫ÊôØÁöÑÂú∞ÊñπÔºåÂÆÉ‰∏ìÈó®‰∏∫Â∞èÁ®ãÂ∫èÂÅö‰∫Ü‰ºòÂåñ„ÄÇ

**ÂÖ∑‰ΩìÈÄªËæëÔºö**

* **Reaction ÈáçÊñ∞ËøêË°å**ÔºöÂΩìÁ¨¨ 3 Ê≠•ÁöÑ Reaction Ë¢´Ëß¶ÂèëÊó∂ÔºåÂÆÉÂπ∂‰∏çÊòØÁÆÄÂçïÂú∞ÊääÊï¥‰∏™ Store Â°ûÁªôÂ∞èÁ®ãÂ∫è„ÄÇ
* **Diff ‰∏é Êò†Â∞Ñ**ÔºöÂÆÉ‰ºöÈáçÊñ∞ËÆ°ÁÆó `fields` ‰∏≠Êò†Â∞ÑÁöÑÊï∞ÊçÆÁöÑÊúÄÊñ∞ÂÄº„ÄÇÂÆÉ‰ºöÂ∞ÜÊñ∞ÂÄº‰∏éÂΩìÂâçÂ∞èÁ®ãÂ∫è `data` ‰∏≠ÁöÑÊóßÂÄºËøõË°åÊØîÂØπÔºàÊàñËÄÖÁõ¥Êé•ÊèêÂèñÊò†Â∞ÑÂêéÁöÑÊñ∞ÂØπË±°Ôºâ„ÄÇ
* **ÊûÑÈÄ† Patch**ÔºöÂÆÉ‰ºöÁîüÊàê‰∏Ä‰∏™Âè™ÂåÖÂê´**ÁúüÊ≠£ÂèòÂåñ‰∫ÜÁöÑÊï∞ÊçÆ**ÁöÑË°•‰∏ÅÂØπË±°ÔºàPatchÔºâ„ÄÇ
* *‰æãÂ¶ÇÔºöStore ÈáåÊúâ 100 ‰∏™Â±ûÊÄßÔºå‰Ω†Âè™Áî®‰∫Ü 2 ‰∏™Ôºå‰∏îËøôÊ¨°Âè™Êúâ‰∏Ä‰∏™Â±ûÊÄßÂèò‰∫ÜÔºåÈÇ£‰πà Patch ÂØπË±°ÈáåÂ∞±Âè™ÊúâÈÇ£‰∏Ä‰∏™ÈîÆÂÄºÂØπ„ÄÇ*


* **Ë∞ÉÁî® setData**ÔºöÊúÄÂêéÔºåÂÆÉË∞ÉÁî®Â∞èÁ®ãÂ∫èÁöÑÂéüÁîü API `this.setData(patch)`„ÄÇ

### ÊÄªÁªìÔºöÂÆÉËß£ÂÜ≥‰∫Ü‰ªÄ‰πàÔºü

1. **Ëß£ÂÜ≥‰∫Ü‚ÄúÊâãÂä®Êå°‚ÄùÁöÑÁπÅÁêê**Ôºö‰Ω†‰∏çÂÜçÈúÄË¶ÅÊâãÂä®Âú®ÈÄªËæë‰ª£Á†ÅÈáåÂà∞Â§ÑÂÜô `this.setData`ÔºåÊï∞ÊçÆÂèò‰∫ÜÔºåÁïåÈù¢Ëá™Âä®Â∞±Âèò‰∫Ü„ÄÇ
2. **Ëß£ÂÜ≥‰∫ÜÊÄßËÉΩÁì∂È¢à**Ôºö
* ÂéüÁîüÂºÄÂèë‰∏≠ÔºåÊñ∞ÊâãÂÆπÊòìÁäØÁöÑÈîôËØØÊòØ `this.setData({ ÂÖ®ÈáèÂ§ßÂØπË±° })`ÔºåÂØºËá¥Â∫ûÂ§ßÁöÑÊï∞ÊçÆÂú®ÈÄªËæëÂ±ÇÂíåËßÜÂõæÂ±Ç‰πãÈó¥ËøõË°åÂ∫èÂàóÂåñÂíå‰º†ËæìÔºåÈÄ†ÊàêÂç°È°ø„ÄÇ
* `mobx-miniprogram` ÈÄöËøáÁ≤æÁ°ÆÁöÑ‰æùËµñÊî∂ÈõÜÔºåÁ°Æ‰øù‰∫ÜÊØèÊ¨° `setData` ‰º†ËæìÁöÑÊï∞ÊçÆÈáèÊòØ**ÊúÄÂ∞èÂøÖË¶Å**ÁöÑÔºå‰ªéËÄå‰øùËØÅ‰∫ÜÈ´òÊÄßËÉΩ„ÄÇ

### ‰∏Ä‰∏™ÁÆÄÂçïüå∞
```js
// store.js Áä∂ÊÄÅÂÆö‰πâ
import { observable } from 'mobx-miniprogram';

const places = observable({
    places: [] as Place[],
    placeDetail: null as Place | null,
    loading: false,
    error: null as string | null,
    setPlaces(list: Place[]) {
        this.places = list;
    },
    setPlaceDetail(id: string) {
        const placeDetail = this.places.find((item) => item.id == id);
        this.placeDetail = placeDetail || null;
    },
    setLoading(v: boolean) {
        this.loading = v;
    },
    setError(msg: string | null) {
        this.error = msg;
    },
    get markers(): MapMarker[] {
        return this.places.map((item: Place) => ({
            id: item.id,
            label: {
                content: item.name || item.title || '',
                color: '#000000',
                fontSize: 12,
            },
            longitude: item.coordinates && item.coordinates.longitude,
            latitude: item.coordinates && item.coordinates.latitude,
            width: 28,
            height: 32,
        }));
    }
});
```

```js
// index.js È°µÈù¢‰ΩøÁî®
import { createStoreBindings } from 'mobx-miniprogram-bindings';
import { placesStore } from '../../store/index';

this.storeBindings = createStoreBindings(this, {
    store: placesStore,
    fields: ['places', 'markers', 'loading', 'error'],
    actions: ['loadPlaces', 'setPlaces', 'setLoading', 'setError'],
});

if (typeof (placesStore as any).loadPlaces === 'function') {
    (placesStore as any).loadPlaces();
}
```